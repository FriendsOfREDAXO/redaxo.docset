<!DOCTYPE html>
<html lang="de">
 <head>
  <meta charset="utf-8"/>
  <link href="../Assets/css/styles.css" rel="stylesheet"/>
  <script src="../Assets/js/script.js">
  </script>
 </head>
 <body>
  <pre id="source"><code><span class="l" id="1">  1 <span class="xlang">&lt;?php</span>
</span><span class="l" id="2">  2 
</span><span class="l" id="3">  3 <span class="php-keyword1">use</span> Leafo\ScssPhp\Compiler;
</span><span class="l" id="4">  4 
</span><span class="l" id="5">  5 <span class="php-comment">/**
</span></span><span class="l" id="6">  6 <span class="php-comment"> * @package redaxo\be-style
</span></span><span class="l" id="7">  7 <span class="php-comment"> */</span>
</span><span class="l" id="8">  8 <span class="php-keyword1">class</span> rex_scss_compiler
</span><span class="l" id="9">  9 {
</span><span class="l" id="10"> 10     <span class="php-keyword1">protected</span> <span class="php-var">$root_dir</span>;
</span><span class="l" id="11"> 11     <span class="php-keyword1">protected</span> <span class="php-var">$scss_file</span>;
</span><span class="l" id="12"> 12     <span class="php-keyword1">protected</span> <span class="php-var">$css_file</span>;
</span><span class="l" id="13"> 13     <span class="php-keyword1">protected</span> <span class="php-var">$formatter</span>;
</span><span class="l" id="14"> 14     <span class="php-keyword1">protected</span> <span class="php-var">$strip_comments</span>;
</span><span class="l" id="15"> 15 
</span><span class="l" id="16"> 16     <span class="php-keyword1">public</span> <span class="php-keyword1">function</span> __construct()
</span><span class="l" id="17"> 17     {
</span><span class="l" id="18"> 18         <span class="php-var">$this</span>-&gt;root_dir = rex_path::addon(<span class="php-quote">'be_style'</span>);
</span><span class="l" id="19"> 19         <span class="php-var">$this</span>-&gt;scss_file = rex_path::addon(<span class="php-quote">'be_style'</span>, <span class="php-quote">'assets'</span>) . <span class="php-quote">'styles.scss'</span>;
</span><span class="l" id="20"> 20         <span class="php-var">$this</span>-&gt;css_file = rex_path::addon(<span class="php-quote">'be_style'</span>, <span class="php-quote">'assets'</span>) . <span class="php-quote">'styles.css'</span>;
</span><span class="l" id="21"> 21         <span class="php-var">$this</span>-&gt;formatter = <span class="php-quote">'Leafo\ScssPhp\Formatter\Compressed'</span>;
</span><span class="l" id="22"> 22         <span class="php-var">$this</span>-&gt;strip_comments = <span class="php-keyword1">true</span>;
</span><span class="l" id="23"> 23     }
</span><span class="l" id="24"> 24 
</span><span class="l" id="25"> 25     <span class="php-keyword1">public</span> <span class="php-keyword1">function</span> setRootDir(<span class="php-var">$value</span>)
</span><span class="l" id="26"> 26     {
</span><span class="l" id="27"> 27         <span class="php-var">$this</span>-&gt;root_dir = <span class="php-var">$value</span>;
</span><span class="l" id="28"> 28     }
</span><span class="l" id="29"> 29 
</span><span class="l" id="30"> 30     <span class="php-keyword1">public</span> <span class="php-keyword1">function</span> setScssFile(<span class="php-var">$value</span>)
</span><span class="l" id="31"> 31     {
</span><span class="l" id="32"> 32         <span class="php-var">$this</span>-&gt;scss_file = <span class="php-var">$value</span>;
</span><span class="l" id="33"> 33     }
</span><span class="l" id="34"> 34 
</span><span class="l" id="35"> 35     <span class="php-keyword1">public</span> <span class="php-keyword1">function</span> setCssFile(<span class="php-var">$value</span>)
</span><span class="l" id="36"> 36     {
</span><span class="l" id="37"> 37         <span class="php-var">$this</span>-&gt;css_file = <span class="php-var">$value</span>;
</span><span class="l" id="38"> 38     }
</span><span class="l" id="39"> 39 
</span><span class="l" id="40"> 40     <span class="php-comment">/*
</span></span><span class="l" id="41"> 41 <span class="php-comment">     * @param string $value scss_formatter (default) or scss_formatter_nested or scss_formatter_compressed
</span></span><span class="l" id="42"> 42 <span class="php-comment">    */</span>
</span><span class="l" id="43"> 43     <span class="php-keyword1">public</span> <span class="php-keyword1">function</span> setFormatter(<span class="php-var">$value</span>)
</span><span class="l" id="44"> 44     {
</span><span class="l" id="45"> 45         <span class="php-var">$this</span>-&gt;formatter = <span class="php-var">$value</span>;
</span><span class="l" id="46"> 46     }
</span><span class="l" id="47"> 47 
</span><span class="l" id="48"> 48     <span class="php-keyword1">public</span> <span class="php-keyword1">function</span> setStripComments(<span class="php-var">$value</span> = <span class="php-keyword1">true</span>)
</span><span class="l" id="49"> 49     {
</span><span class="l" id="50"> 50         <span class="php-var">$this</span>-&gt;strip_comments = <span class="php-var">$value</span>;
</span><span class="l" id="51"> 51     }
</span><span class="l" id="52"> 52 
</span><span class="l" id="53"> 53     <span class="php-comment">/*
</span></span><span class="l" id="54"> 54 <span class="php-comment">     * @param string $scss_folder source folder where you have your .scss files
</span></span><span class="l" id="55"> 55 <span class="php-comment">     * @param string $scss_global_file
</span></span><span class="l" id="56"> 56 <span class="php-comment">     * @param string $format_style CSS output format
</span></span><span class="l" id="57"> 57 <span class="php-comment">     * @param bool $strip_comments
</span></span><span class="l" id="58"> 58 <span class="php-comment">     */</span>
</span><span class="l" id="59"> 59     <span class="php-keyword1">public</span> <span class="php-keyword1">function</span> compile()
</span><span class="l" id="60"> 60     {
</span><span class="l" id="61"> 61         <span class="php-comment">// go on even if user "stops" the script by closing the browser, closing the terminal etc.</span>
</span><span class="l" id="62"> 62         <span class="php-keyword2">ignore_user_abort</span>(<span class="php-keyword1">true</span>);
</span><span class="l" id="63"> 63         <span class="php-comment">// set script running time to unlimited</span>
</span><span class="l" id="64"> 64         <span class="php-keyword2">set_time_limit</span>(<span class="php-num">0</span>);
</span><span class="l" id="65"> 65 
</span><span class="l" id="66"> 66         <span class="php-var">$root_dir</span> = <span class="php-var">$this</span>-&gt;root_dir;
</span><span class="l" id="67"> 67 
</span><span class="l" id="68"> 68         <span class="php-var">$scss_compiler</span> = <span class="php-keyword1">new</span> Compiler();
</span><span class="l" id="69"> 69         <span class="php-var">$scss_compiler</span>-&gt;setNumberPrecision(<span class="php-num">10</span>);
</span><span class="l" id="70"> 70         <span class="php-var">$scss_compiler</span>-&gt;stripComments = <span class="php-var">$this</span>-&gt;strip_comments;
</span><span class="l" id="71"> 71 
</span><span class="l" id="72"> 72         <span class="php-var">$scss_compiler</span>-&gt;addImportPath(<span class="php-keyword1">function</span> (<span class="php-var">$path</span>) <span class="php-keyword1">use</span> (<span class="php-var">$root_dir</span>) {
</span><span class="l" id="73"> 73             <span class="php-var">$path</span> = <span class="php-var">$root_dir</span> . <span class="php-var">$path</span> . <span class="php-quote">'.scss'</span>;
</span><span class="l" id="74"> 74 
</span><span class="l" id="75"> 75             <span class="php-var">$path_parts</span> = <span class="php-keyword2">pathinfo</span>(<span class="php-var">$path</span>);
</span><span class="l" id="76"> 76             <span class="php-var">$underscore_file</span> = <span class="php-var">$path_parts</span>[<span class="php-quote">'dirname'</span>] . <span class="php-quote">'/_'</span> . <span class="php-var">$path_parts</span>[<span class="php-quote">'basename'</span>];
</span><span class="l" id="77"> 77 
</span><span class="l" id="78"> 78             <span class="php-keyword1">if</span> (<span class="php-keyword2">file_exists</span>(<span class="php-var">$underscore_file</span>)) {
</span><span class="l" id="79"> 79                 <span class="php-var">$path</span> = <span class="php-var">$underscore_file</span>;
</span><span class="l" id="80"> 80             }
</span><span class="l" id="81"> 81 
</span><span class="l" id="82"> 82             <span class="php-keyword1">if</span> (!<span class="php-keyword2">file_exists</span>(<span class="php-var">$path</span>)) {
</span><span class="l" id="83"> 83                 <span class="php-keyword1">return</span> <span class="php-keyword1">null</span>;
</span><span class="l" id="84"> 84             }
</span><span class="l" id="85"> 85 
</span><span class="l" id="86"> 86             <span class="php-keyword1">return</span> <span class="php-var">$path</span>;
</span><span class="l" id="87"> 87         });
</span><span class="l" id="88"> 88         <span class="php-comment">// set the path to your to-be-imported mixins. please note: custom paths are coming up on future releases!</span>
</span><span class="l" id="89"> 89         <span class="php-comment">//$scss_compiler-&gt;setImportPaths($scss_folder);</span>
</span><span class="l" id="90"> 90 
</span><span class="l" id="91"> 91         <span class="php-comment">// set css formatting (normal, nested or minimized), @see http://leafo.net/scssphp/docs/#output_formatting</span>
</span><span class="l" id="92"> 92         <span class="php-var">$scss_compiler</span>-&gt;setFormatter(<span class="php-var">$this</span>-&gt;formatter);
</span><span class="l" id="93"> 93 
</span><span class="l" id="94"> 94         <span class="php-comment">// get .scss's content, put it into $string_sass</span>
</span><span class="l" id="95"> 95         <span class="php-var">$string_sass</span> = <span class="php-quote">''</span>;
</span><span class="l" id="96"> 96         <span class="php-keyword1">if</span> (<span class="php-keyword2">is_array</span>(<span class="php-var">$this</span>-&gt;scss_file)) {
</span><span class="l" id="97"> 97             <span class="php-keyword1">foreach</span> (<span class="php-var">$this</span>-&gt;scss_file <span class="php-keyword1">as</span> <span class="php-var">$scss_file</span>) {
</span><span class="l" id="98"> 98                 <span class="php-var">$string_sass</span> .= rex_file::get(<span class="php-var">$scss_file</span>);
</span><span class="l" id="99"> 99             }
</span><span class="l" id="100">100         } <span class="php-keyword1">else</span> {
</span><span class="l" id="101">101             <span class="php-var">$string_sass</span> = rex_file::get(<span class="php-var">$this</span>-&gt;scss_file);
</span><span class="l" id="102">102         }
</span><span class="l" id="103">103 
</span><span class="l" id="104">104         <span class="php-comment">// try/catch block to prevent script stopping when scss compiler throws an error</span>
</span><span class="l" id="105">105         <span class="php-keyword1">try</span> {
</span><span class="l" id="106">106             <span class="php-comment">// compile this SASS code to CSS</span>
</span><span class="l" id="107">107             <span class="php-var">$string_css</span> = <span class="php-var">$scss_compiler</span>-&gt;compile(<span class="php-var">$string_sass</span>) . <span class="php-quote">"\n"</span>;
</span><span class="l" id="108">108 
</span><span class="l" id="109">109             <span class="php-comment">// $string_css = csscrush_string($string_css, $options = array('minify' =&gt; true));</span>
</span><span class="l" id="110">110 
</span><span class="l" id="111">111             <span class="php-comment">// write CSS into file with the same filename, but .css extension</span>
</span><span class="l" id="112">112             rex_file::put(<span class="php-var">$this</span>-&gt;css_file, <span class="php-var">$string_css</span>);
</span><span class="l" id="113">113         } <span class="php-keyword1">catch</span> (Exception <span class="php-var">$e</span>) {
</span><span class="l" id="114">114             <span class="php-comment">// here we could put the exception message, but who cares ...</span>
</span><span class="l" id="115">115             <span class="php-keyword1">echo</span> <span class="php-var">$e</span>-&gt;getMessage();
</span><span class="l" id="116">116             <span class="php-keyword1">exit</span>();
</span><span class="l" id="117">117         }
</span><span class="l" id="118">118     }
</span><span class="l" id="119">119 }
</span><span class="l" id="120">120 </span></code></pre>
 </body>
</html>
