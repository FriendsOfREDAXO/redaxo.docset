<!DOCTYPE html>
<html lang="de">
 <head>
  <meta charset="utf-8"/>
  <link href="../Assets/css/styles.css" rel="stylesheet"/>
  <script src="../Assets/js/script.js">
  </script>
 </head>
 <body>
  <pre id="source"><code><span class="l" id="1"> 1 <span class="xlang">&lt;?php</span>
</span><span class="l" id="2"> 2 
</span><span class="l" id="3"> 3 <span class="php-comment">/**
</span></span><span class="l" id="4"> 4 <span class="php-comment"> * @package redaxo\media-manager
</span></span><span class="l" id="5"> 5 <span class="php-comment"> */</span>
</span><span class="l" id="6"> 6 <span class="php-keyword1">class</span> rex_effect_header <span class="php-keyword1">extends</span> rex_effect_abstract
</span><span class="l" id="7"> 7 {
</span><span class="l" id="8"> 8     <span class="php-keyword1">public</span> <span class="php-keyword1">function</span> execute()
</span><span class="l" id="9"> 9     {
</span><span class="l" id="10">10         <span class="php-keyword1">if</span> (<span class="php-var">$this</span>-&gt;params[<span class="php-quote">'cache'</span>] == <span class="php-quote">'no_cache'</span>) {
</span><span class="l" id="11">11             <span class="php-var">$this</span>-&gt;media-&gt;setHeader(<span class="php-quote">'Cache-Control'</span>, <span class="php-quote">'must-revalidate, proxy-revalidate, private, no-cache, max-age=0'</span>);
</span><span class="l" id="12">12             <span class="php-var">$this</span>-&gt;media-&gt;setHeader(<span class="php-quote">'Expires'</span>, <span class="php-quote">'Sat, 26 Jul 1997 05:00:00 GMT'</span>); <span class="php-comment">// in the past</span>
</span><span class="l" id="13">13         } <span class="php-keyword1">elseif</span> (<span class="php-var">$this</span>-&gt;params[<span class="php-quote">'cache'</span>] !== <span class="php-quote">'cache'</span> <span class="php-comment">/* bc */</span> &amp;&amp; <span class="php-var">$this</span>-&gt;params[<span class="php-quote">'cache'</span>] !== <span class="php-quote">'unspecified'</span>) {
</span><span class="l" id="14">14             <span class="php-keyword1">switch</span> (<span class="php-var">$this</span>-&gt;params[<span class="php-quote">'cache'</span>]) {
</span><span class="l" id="15">15                 <span class="php-keyword1">case</span> <span class="php-quote">'max-age: 1 min'</span>:
</span><span class="l" id="16">16                     <span class="php-var">$seconds</span> = <span class="php-num">60</span>;
</span><span class="l" id="17">17                     <span class="php-keyword1">break</span>;
</span><span class="l" id="18">18                 <span class="php-keyword1">case</span> <span class="php-quote">'max-age: 1 hour'</span>:
</span><span class="l" id="19">19                     <span class="php-var">$seconds</span> = <span class="php-num">60</span> * <span class="php-num">60</span>;
</span><span class="l" id="20">20                     <span class="php-keyword1">break</span>;
</span><span class="l" id="21">21                 <span class="php-keyword1">case</span> <span class="php-quote">'max-age: 1 day'</span>:
</span><span class="l" id="22">22                     <span class="php-var">$seconds</span> = <span class="php-num">60</span> * <span class="php-num">60</span> * <span class="php-num">24</span>;
</span><span class="l" id="23">23                     <span class="php-keyword1">break</span>;
</span><span class="l" id="24">24                 <span class="php-keyword1">case</span> <span class="php-quote">'max-age: 1 week'</span>:
</span><span class="l" id="25">25                     <span class="php-var">$seconds</span> = <span class="php-num">60</span> * <span class="php-num">60</span> * <span class="php-num">24</span> * <span class="php-num">7</span>;
</span><span class="l" id="26">26                     <span class="php-keyword1">break</span>;
</span><span class="l" id="27">27                 <span class="php-keyword1">case</span> <span class="php-quote">'max-age: 1 month'</span>:
</span><span class="l" id="28">28                     <span class="php-var">$seconds</span> = <span class="php-num">60</span> * <span class="php-num">60</span> * <span class="php-num">24</span> * <span class="php-num">30</span>;
</span><span class="l" id="29">29                     <span class="php-keyword1">break</span>;
</span><span class="l" id="30">30                 <span class="php-keyword1">case</span> <span class="php-quote">'max-age: 1 year'</span>:
</span><span class="l" id="31">31                 <span class="php-keyword1">case</span> <span class="php-quote">'immutable'</span>:
</span><span class="l" id="32">32                     <span class="php-var">$seconds</span> = <span class="php-num">60</span> * <span class="php-num">60</span> * <span class="php-num">24</span> * <span class="php-num">365</span>;
</span><span class="l" id="33">33                     <span class="php-keyword1">break</span>;
</span><span class="l" id="34">34                 <span class="php-keyword1">default</span>:
</span><span class="l" id="35">35                     <span class="php-keyword1">throw</span> <span class="php-keyword1">new</span> LogicException(<span class="php-keyword2">sprintf</span>(<span class="php-quote">'Unsupported cache duration "%s".'</span>, <span class="php-var">$this</span>-&gt;params[<span class="php-quote">'cache'</span>]));
</span><span class="l" id="36">36             }
</span><span class="l" id="37">37 
</span><span class="l" id="38">38             <span class="php-var">$cacheControl</span> = <span class="php-quote">'proxy-revalidate, private, max-age='</span>.<span class="php-var">$seconds</span>;
</span><span class="l" id="39">39 
</span><span class="l" id="40">40             <span class="php-keyword1">if</span> (<span class="php-quote">'immutable'</span> === <span class="php-var">$this</span>-&gt;params[<span class="php-quote">'cache'</span>]) {
</span><span class="l" id="41">41                 <span class="php-var">$cacheControl</span> .= <span class="php-quote">', immutable'</span>;
</span><span class="l" id="42">42             }
</span><span class="l" id="43">43 
</span><span class="l" id="44">44             <span class="php-var">$this</span>-&gt;media-&gt;setHeader(<span class="php-quote">'Cache-Control'</span>, <span class="php-var">$cacheControl</span>);
</span><span class="l" id="45">45         }
</span><span class="l" id="46">46 
</span><span class="l" id="47">47         <span class="php-keyword1">if</span> (<span class="php-var">$this</span>-&gt;params[<span class="php-quote">'download'</span>] == <span class="php-quote">'download'</span>) {
</span><span class="l" id="48">48             <span class="php-var">$this</span>-&gt;media-&gt;setHeader(<span class="php-quote">'Content-Disposition'</span>, <span class="php-quote">'attachment; filename="'</span> . <span class="php-keyword2">basename</span>(<span class="php-var">$this</span>-&gt;media-&gt;getMediaFilename()) . <span class="php-quote">'";'</span>);
</span><span class="l" id="49">49         }
</span><span class="l" id="50">50 
</span><span class="l" id="51">51         <span class="php-comment">/*
</span></span><span class="l" id="52">52 <span class="php-comment">         header("Pragma: public"); // required
</span></span><span class="l" id="53">53 <span class="php-comment">         header("Expires: 0");
</span></span><span class="l" id="54">54 <span class="php-comment">         header("Content-Transfer-Encoding: binary");
</span></span><span class="l" id="55">55 <span class="php-comment">         header("Content-Length: ".$fsize);
</span></span><span class="l" id="56">56 <span class="php-comment">         */</span>
</span><span class="l" id="57">57     }
</span><span class="l" id="58">58 
</span><span class="l" id="59">59     <span class="php-keyword1">public</span> <span class="php-keyword1">function</span> getName()
</span><span class="l" id="60">60     {
</span><span class="l" id="61">61         <span class="php-keyword1">return</span> rex_i18n::msg(<span class="php-quote">'media_manager_effect_header'</span>);
</span><span class="l" id="62">62     }
</span><span class="l" id="63">63 
</span><span class="l" id="64">64     <span class="php-keyword1">public</span> <span class="php-keyword1">function</span> getParams()
</span><span class="l" id="65">65     {
</span><span class="l" id="66">66         <span class="php-keyword1">return</span> [
</span><span class="l" id="67">67             [
</span><span class="l" id="68">68                 <span class="php-quote">'label'</span> =&gt; rex_i18n::msg(<span class="php-quote">'media_manager_effect_header_download'</span>),
</span><span class="l" id="69">69                 <span class="php-quote">'name'</span> =&gt; <span class="php-quote">'download'</span>,
</span><span class="l" id="70">70                 <span class="php-quote">'type'</span> =&gt; <span class="php-quote">'select'</span>,
</span><span class="l" id="71">71                 <span class="php-quote">'options'</span> =&gt; [<span class="php-quote">'open_media'</span>, <span class="php-quote">'download'</span>],
</span><span class="l" id="72">72                 <span class="php-quote">'default'</span> =&gt; <span class="php-quote">'open_media'</span>,
</span><span class="l" id="73">73             ],
</span><span class="l" id="74">74             [
</span><span class="l" id="75">75                 <span class="php-quote">'label'</span> =&gt; rex_i18n::msg(<span class="php-quote">'media_manager_effect_header_cache'</span>),
</span><span class="l" id="76">76                 <span class="php-quote">'name'</span> =&gt; <span class="php-quote">'cache'</span>,
</span><span class="l" id="77">77                 <span class="php-quote">'type'</span> =&gt; <span class="php-quote">'select'</span>,
</span><span class="l" id="78">78                 <span class="php-quote">'options'</span> =&gt; [<span class="php-quote">'no_cache'</span>, <span class="php-quote">'unspecified'</span>, <span class="php-quote">'max-age: 1 min'</span>, <span class="php-quote">'max-age: 1 hour'</span>, <span class="php-quote">'max-age: 1 day'</span>, <span class="php-quote">'max-age: 1 week'</span>, <span class="php-quote">'max-age: 1 month'</span>, <span class="php-quote">'max-age: 1 year'</span>, <span class="php-quote">'immutable'</span>],
</span><span class="l" id="79">79                 <span class="php-quote">'default'</span> =&gt; <span class="php-quote">'no_cache'</span>,
</span><span class="l" id="80">80             ],
</span><span class="l" id="81">81         ];
</span><span class="l" id="82">82     }
</span><span class="l" id="83">83 }
</span><span class="l" id="84">84 </span></code></pre>
 </body>
</html>
