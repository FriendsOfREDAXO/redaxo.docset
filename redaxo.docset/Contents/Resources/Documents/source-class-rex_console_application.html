<!DOCTYPE html>
<html lang="de">
 <head>
  <meta charset="utf-8"/>
  <link href="../Assets/css/styles.css" rel="stylesheet"/>
  <script src="../Assets/js/script.js">
  </script>
 </head>
 <body>
  <pre id="source"><code><span class="l" id="1"> 1 <span class="xlang">&lt;?php</span>
</span><span class="l" id="2"> 2 
</span><span class="l" id="3"> 3 <span class="php-keyword1">use</span> Symfony\Component\Console\Application;
</span><span class="l" id="4"> 4 <span class="php-keyword1">use</span> Symfony\Component\Console\Command\Command;
</span><span class="l" id="5"> 5 <span class="php-keyword1">use</span> Symfony\Component\Console\Input\InputInterface;
</span><span class="l" id="6"> 6 <span class="php-keyword1">use</span> Symfony\Component\Console\Output\OutputInterface;
</span><span class="l" id="7"> 7 <span class="php-keyword1">use</span> Symfony\Component\Debug\Exception\FatalThrowableError;
</span><span class="l" id="8"> 8 
</span><span class="l" id="9"> 9 <span class="php-comment">/**
</span></span><span class="l" id="10">10 <span class="php-comment"> * @package redaxo\core
</span></span><span class="l" id="11">11 <span class="php-comment"> */</span>
</span><span class="l" id="12">12 <span class="php-keyword1">class</span> rex_console_application <span class="php-keyword1">extends</span> Application
</span><span class="l" id="13">13 {
</span><span class="l" id="14">14     <span class="php-keyword1">public</span> <span class="php-keyword1">function</span> __construct()
</span><span class="l" id="15">15     {
</span><span class="l" id="16">16         parent::__construct(<span class="php-quote">'REDAXO'</span>, rex::getVersion());
</span><span class="l" id="17">17     }
</span><span class="l" id="18">18 
</span><span class="l" id="19">19     <span class="php-keyword1">public</span> <span class="php-keyword1">function</span> doRun(InputInterface <span class="php-var">$input</span>, OutputInterface <span class="php-var">$output</span>)
</span><span class="l" id="20">20     {
</span><span class="l" id="21">21         <span class="php-keyword1">try</span> {
</span><span class="l" id="22">22             <span class="php-keyword1">return</span> parent::doRun(<span class="php-var">$input</span>, <span class="php-var">$output</span>);
</span><span class="l" id="23">23         } <span class="php-keyword1">catch</span> (\Exception <span class="php-var">$e</span>) {
</span><span class="l" id="24">24             <span class="php-comment">// catch and rethrow \Exceptions first to only catch fatal errors below (\Exception implements \Throwable)</span>
</span><span class="l" id="25">25             <span class="php-keyword1">throw</span> <span class="php-var">$e</span>;
</span><span class="l" id="26">26         } <span class="php-keyword1">catch</span> (\Throwable <span class="php-var">$e</span>) {
</span><span class="l" id="27">27             <span class="php-keyword1">throw</span> <span class="php-keyword1">new</span> FatalThrowableError(<span class="php-var">$e</span>);
</span><span class="l" id="28">28         }
</span><span class="l" id="29">29     }
</span><span class="l" id="30">30 
</span><span class="l" id="31">31     <span class="php-keyword1">protected</span> <span class="php-keyword1">function</span> doRunCommand(Command <span class="php-var">$command</span>, InputInterface <span class="php-var">$input</span>, OutputInterface <span class="php-var">$output</span>)
</span><span class="l" id="32">32     {
</span><span class="l" id="33">33         <span class="php-keyword1">if</span> (<span class="php-var">$command</span> <span class="php-keyword1">instanceof</span> rex_console_command) {
</span><span class="l" id="34">34             <span class="php-var">$this</span>-&gt;loadPackages(<span class="php-var">$command</span>);
</span><span class="l" id="35">35         }
</span><span class="l" id="36">36 
</span><span class="l" id="37">37         <span class="php-keyword1">return</span> parent::doRunCommand(<span class="php-var">$command</span>, <span class="php-var">$input</span>, <span class="php-var">$output</span>);
</span><span class="l" id="38">38     }
</span><span class="l" id="39">39 
</span><span class="l" id="40">40     <span class="php-keyword1">private</span> <span class="php-keyword1">function</span> loadPackages(rex_console_command <span class="php-var">$command</span>)
</span><span class="l" id="41">41     {
</span><span class="l" id="42">42         <span class="php-keyword1">if</span> (<span class="php-quote">'ydeploy:migrate'</span> === <span class="php-var">$command</span>-&gt;getName()) {
</span><span class="l" id="43">43             <span class="php-var">$command</span>-&gt;getPackage()-&gt;boot();
</span><span class="l" id="44">44 
</span><span class="l" id="45">45             <span class="php-keyword1">return</span>;
</span><span class="l" id="46">46         }
</span><span class="l" id="47">47 
</span><span class="l" id="48">48         <span class="php-keyword1">foreach</span> (rex::getConfig(<span class="php-quote">'package-order'</span>) <span class="php-keyword1">as</span> <span class="php-var">$packageId</span>) {
</span><span class="l" id="49">49             rex_package::get(<span class="php-var">$packageId</span>)-&gt;boot();
</span><span class="l" id="50">50         }
</span><span class="l" id="51">51 
</span><span class="l" id="52">52         rex_extension::registerPoint(<span class="php-keyword1">new</span> rex_extension_point(<span class="php-quote">'PACKAGES_INCLUDED'</span>));
</span><span class="l" id="53">53     }
</span><span class="l" id="54">54 }
</span><span class="l" id="55">55 </span></code></pre>
 </body>
</html>
