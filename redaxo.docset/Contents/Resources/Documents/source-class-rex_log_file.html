<!DOCTYPE html>
<html lang="de">
 <head>
  <meta charset="utf-8"/>
  <link href="../Assets/css/styles.css" rel="stylesheet"/>
  <script src="../Assets/js/script.js">
  </script>
 </head>
 <body>
  <pre id="source"><code><span class="l" id="1">  1 <span class="xlang">&lt;?php</span>
</span><span class="l" id="2">  2 
</span><span class="l" id="3">  3 <span class="php-comment">/**
</span></span><span class="l" id="4">  4 <span class="php-comment"> * Log file class.
</span></span><span class="l" id="5">  5 <span class="php-comment"> *
</span></span><span class="l" id="6">  6 <span class="php-comment"> * @author gharlan
</span></span><span class="l" id="7">  7 <span class="php-comment"> *
</span></span><span class="l" id="8">  8 <span class="php-comment"> * @package redaxo\core
</span></span><span class="l" id="9">  9 <span class="php-comment"> */</span>
</span><span class="l" id="10"> 10 <span class="php-keyword1">class</span> rex_log_file <span class="php-keyword1">implements</span> Iterator
</span><span class="l" id="11"> 11 {
</span><span class="l" id="12"> 12     <span class="php-comment">/** @var string */</span>
</span><span class="l" id="13"> 13     <span class="php-keyword1">private</span> <span class="php-var">$path</span>;
</span><span class="l" id="14"> 14 
</span><span class="l" id="15"> 15     <span class="php-comment">/** @var resource */</span>
</span><span class="l" id="16"> 16     <span class="php-keyword1">private</span> <span class="php-var">$file</span>;
</span><span class="l" id="17"> 17 
</span><span class="l" id="18"> 18     <span class="php-comment">/** @var resource */</span>
</span><span class="l" id="19"> 19     <span class="php-keyword1">private</span> <span class="php-var">$file2</span>;
</span><span class="l" id="20"> 20 
</span><span class="l" id="21"> 21     <span class="php-comment">/** @var bool */</span>
</span><span class="l" id="22"> 22     <span class="php-keyword1">private</span> <span class="php-var">$second</span> = <span class="php-keyword1">false</span>;
</span><span class="l" id="23"> 23 
</span><span class="l" id="24"> 24     <span class="php-comment">/** @var int */</span>
</span><span class="l" id="25"> 25     <span class="php-keyword1">private</span> <span class="php-var">$pos</span>;
</span><span class="l" id="26"> 26 
</span><span class="l" id="27"> 27     <span class="php-comment">/** @var int */</span>
</span><span class="l" id="28"> 28     <span class="php-keyword1">private</span> <span class="php-var">$key</span>;
</span><span class="l" id="29"> 29 
</span><span class="l" id="30"> 30     <span class="php-comment">/** @var string */</span>
</span><span class="l" id="31"> 31     <span class="php-keyword1">private</span> <span class="php-var">$currentLine</span>;
</span><span class="l" id="32"> 32 
</span><span class="l" id="33"> 33     <span class="php-comment">/** @var string */</span>
</span><span class="l" id="34"> 34     <span class="php-keyword1">private</span> <span class="php-var">$buffer</span>;
</span><span class="l" id="35"> 35 
</span><span class="l" id="36"> 36     <span class="php-comment">/** @var int */</span>
</span><span class="l" id="37"> 37     <span class="php-keyword1">private</span> <span class="php-var">$bufferPos</span>;
</span><span class="l" id="38"> 38 
</span><span class="l" id="39"> 39     <span class="php-comment">/**
</span></span><span class="l" id="40"> 40 <span class="php-comment">     * Constructor.
</span></span><span class="l" id="41"> 41 <span class="php-comment">     *
</span></span><span class="l" id="42"> 42 <span class="php-comment">     * @param string   $path        File path
</span></span><span class="l" id="43"> 43 <span class="php-comment">     * @param int|null $maxFileSize Maximum file size
</span></span><span class="l" id="44"> 44 <span class="php-comment">     */</span>
</span><span class="l" id="45"> 45     <span class="php-keyword1">public</span> <span class="php-keyword1">function</span> __construct(<span class="php-var">$path</span>, <span class="php-var">$maxFileSize</span> = <span class="php-keyword1">null</span>)
</span><span class="l" id="46"> 46     {
</span><span class="l" id="47"> 47         <span class="php-var">$this</span>-&gt;path = <span class="php-var">$path</span>;
</span><span class="l" id="48"> 48         <span class="php-keyword1">if</span> (!<span class="php-keyword2">file_exists</span>(<span class="php-var">$path</span>)) {
</span><span class="l" id="49"> 49             rex_file::put(<span class="php-var">$path</span>, <span class="php-quote">''</span>);
</span><span class="l" id="50"> 50         }
</span><span class="l" id="51"> 51         <span class="php-keyword1">if</span> (<span class="php-var">$maxFileSize</span> &amp;&amp; <span class="php-keyword2">file_exists</span>(<span class="php-var">$path</span>) &amp;&amp; <span class="php-keyword2">filesize</span>(<span class="php-var">$path</span>) &gt; <span class="php-var">$maxFileSize</span>) {
</span><span class="l" id="52"> 52             <span class="php-keyword2">rename</span>(<span class="php-var">$path</span>, <span class="php-var">$path</span> . <span class="php-quote">'.2'</span>);
</span><span class="l" id="53"> 53         }
</span><span class="l" id="54"> 54         <span class="php-var">$this</span>-&gt;<span class="php-keyword2">file</span> = <span class="php-keyword2">fopen</span>(<span class="php-var">$path</span>, <span class="php-quote">'a+b'</span>);
</span><span class="l" id="55"> 55     }
</span><span class="l" id="56"> 56 
</span><span class="l" id="57"> 57     <span class="php-comment">/**
</span></span><span class="l" id="58"> 58 <span class="php-comment">     * Adds a log entry.
</span></span><span class="l" id="59"> 59 <span class="php-comment">     *
</span></span><span class="l" id="60"> 60 <span class="php-comment">     * @param array $data Log data
</span></span><span class="l" id="61"> 61 <span class="php-comment">     */</span>
</span><span class="l" id="62"> 62     <span class="php-keyword1">public</span> <span class="php-keyword1">function</span> add(<span class="php-keyword1">array</span> <span class="php-var">$data</span>)
</span><span class="l" id="63"> 63     {
</span><span class="l" id="64"> 64         <span class="php-keyword2">fseek</span>(<span class="php-var">$this</span>-&gt;<span class="php-keyword2">file</span>, <span class="php-num">0</span>, SEEK_END);
</span><span class="l" id="65"> 65         <span class="php-keyword2">fwrite</span>(<span class="php-var">$this</span>-&gt;<span class="php-keyword2">file</span>, <span class="php-keyword1">new</span> rex_log_entry(<span class="php-keyword2">time</span>(), <span class="php-var">$data</span>) . <span class="php-quote">"\n"</span>);
</span><span class="l" id="66"> 66     }
</span><span class="l" id="67"> 67 
</span><span class="l" id="68"> 68     <span class="php-comment">/**
</span></span><span class="l" id="69"> 69 <span class="php-comment">     * @return rex_log_entry
</span></span><span class="l" id="70"> 70 <span class="php-comment">     */</span>
</span><span class="l" id="71"> 71     <span class="php-keyword1">public</span> <span class="php-keyword1">function</span> <span class="php-keyword2">current</span>()
</span><span class="l" id="72"> 72     {
</span><span class="l" id="73"> 73         <span class="php-keyword1">return</span> rex_log_entry::createFromString(<span class="php-var">$this</span>-&gt;currentLine);
</span><span class="l" id="74"> 74     }
</span><span class="l" id="75"> 75 
</span><span class="l" id="76"> 76     <span class="php-comment">/**
</span></span><span class="l" id="77"> 77 <span class="php-comment">     * Reads the log file backwards line by line (each call reads one line).
</span></span><span class="l" id="78"> 78 <span class="php-comment">     */</span>
</span><span class="l" id="79"> 79     <span class="php-keyword1">public</span> <span class="php-keyword1">function</span> <span class="php-keyword2">next</span>()
</span><span class="l" id="80"> 80     {
</span><span class="l" id="81"> 81         <span class="php-keyword1">static</span> <span class="php-var">$bufferSize</span> = <span class="php-num">500</span>;
</span><span class="l" id="82"> 82 
</span><span class="l" id="83"> 83         <span class="php-keyword1">if</span> (<span class="php-var">$this</span>-&gt;<span class="php-keyword2">pos</span> &lt; <span class="php-num">0</span>) {
</span><span class="l" id="84"> 84             <span class="php-comment">// position is before file start -&gt; look for next file</span>
</span><span class="l" id="85"> 85             <span class="php-var">$path2</span> = <span class="php-var">$this</span>-&gt;path . <span class="php-quote">'.2'</span>;
</span><span class="l" id="86"> 86             <span class="php-keyword1">if</span> (<span class="php-var">$this</span>-&gt;second || !<span class="php-var">$this</span>-&gt;file2 &amp;&amp; !<span class="php-keyword2">file_exists</span>(<span class="php-var">$path2</span>)) {
</span><span class="l" id="87"> 87                 <span class="php-comment">// already in file2 or file2 does not exist -&gt; mark currentLine as invalid</span>
</span><span class="l" id="88"> 88                 <span class="php-var">$this</span>-&gt;currentLine = <span class="php-keyword1">null</span>;
</span><span class="l" id="89"> 89                 <span class="php-var">$this</span>-&gt;<span class="php-keyword2">key</span> = <span class="php-keyword1">null</span>;
</span><span class="l" id="90"> 90                 <span class="php-keyword1">return</span>;
</span><span class="l" id="91"> 91             }
</span><span class="l" id="92"> 92             <span class="php-comment">// switch to file2 and reset position</span>
</span><span class="l" id="93"> 93             <span class="php-keyword1">if</span> (!<span class="php-var">$this</span>-&gt;file2) {
</span><span class="l" id="94"> 94                 <span class="php-var">$this</span>-&gt;file2 = <span class="php-keyword2">fopen</span>(<span class="php-var">$path2</span>, <span class="php-quote">'rb'</span>);
</span><span class="l" id="95"> 95             }
</span><span class="l" id="96"> 96             <span class="php-var">$this</span>-&gt;second = <span class="php-keyword1">true</span>;
</span><span class="l" id="97"> 97             <span class="php-var">$this</span>-&gt;<span class="php-keyword2">pos</span> = <span class="php-keyword1">null</span>;
</span><span class="l" id="98"> 98         }
</span><span class="l" id="99"> 99 
</span><span class="l" id="100">100         <span class="php-comment">// get current file</span>
</span><span class="l" id="101">101         <span class="php-var">$file</span> = <span class="php-var">$this</span>-&gt;second ? <span class="php-var">$this</span>-&gt;file2 : <span class="php-var">$this</span>-&gt;<span class="php-keyword2">file</span>;
</span><span class="l" id="102">102 
</span><span class="l" id="103">103         <span class="php-keyword1">if</span> (<span class="php-keyword1">null</span> === <span class="php-var">$this</span>-&gt;<span class="php-keyword2">pos</span>) {
</span><span class="l" id="104">104             <span class="php-comment">// position is not set -&gt; set start position to start of last buffer</span>
</span><span class="l" id="105">105             <span class="php-keyword2">fseek</span>(<span class="php-var">$file</span>, <span class="php-num">0</span>, SEEK_END);
</span><span class="l" id="106">106             <span class="php-var">$this</span>-&gt;<span class="php-keyword2">pos</span> = (int) (<span class="php-keyword2">ftell</span>(<span class="php-var">$file</span>) / <span class="php-var">$bufferSize</span>) * <span class="php-var">$bufferSize</span>;
</span><span class="l" id="107">107         }
</span><span class="l" id="108">108 
</span><span class="l" id="109">109         <span class="php-var">$line</span> = <span class="php-quote">''</span>;
</span><span class="l" id="110">110         <span class="php-comment">// while position is not before file start</span>
</span><span class="l" id="111">111         <span class="php-keyword1">while</span> (<span class="php-var">$this</span>-&gt;<span class="php-keyword2">pos</span> &gt;= <span class="php-num">0</span>) {
</span><span class="l" id="112">112             <span class="php-keyword1">if</span> (<span class="php-var">$this</span>-&gt;bufferPos &lt; <span class="php-num">0</span>) {
</span><span class="l" id="113">113                 <span class="php-comment">// read next buffer</span>
</span><span class="l" id="114">114                 <span class="php-keyword2">fseek</span>(<span class="php-var">$file</span>, <span class="php-var">$this</span>-&gt;<span class="php-keyword2">pos</span>);
</span><span class="l" id="115">115                 <span class="php-var">$this</span>-&gt;buffer = <span class="php-keyword2">fread</span>(<span class="php-var">$file</span>, <span class="php-var">$bufferSize</span>);
</span><span class="l" id="116">116                 <span class="php-var">$this</span>-&gt;bufferPos = <span class="php-keyword2">strlen</span>(<span class="php-var">$this</span>-&gt;buffer) - <span class="php-num">1</span>;
</span><span class="l" id="117">117             }
</span><span class="l" id="118">118             <span class="php-comment">// read buffer backwards char by char</span>
</span><span class="l" id="119">119             <span class="php-keyword1">for</span> (; <span class="php-var">$this</span>-&gt;bufferPos &gt;= <span class="php-num">0</span>; --<span class="php-var">$this</span>-&gt;bufferPos) {
</span><span class="l" id="120">120                 <span class="php-var">$char</span> = <span class="php-var">$this</span>-&gt;buffer[<span class="php-var">$this</span>-&gt;bufferPos];
</span><span class="l" id="121">121                 <span class="php-keyword1">if</span> (<span class="php-quote">"\n"</span> === <span class="php-var">$char</span>) {
</span><span class="l" id="122">122                     <span class="php-comment">// line start reached -&gt; prepare bufferPos/pos and jump outside of while-loop</span>
</span><span class="l" id="123">123                     --<span class="php-var">$this</span>-&gt;bufferPos;
</span><span class="l" id="124">124                     <span class="php-keyword1">if</span> (<span class="php-var">$this</span>-&gt;bufferPos &lt; <span class="php-num">0</span>) {
</span><span class="l" id="125">125                         <span class="php-var">$this</span>-&gt;<span class="php-keyword2">pos</span> -= <span class="php-var">$bufferSize</span>;
</span><span class="l" id="126">126                     }
</span><span class="l" id="127">127                     <span class="php-keyword1">break</span> <span class="php-num">2</span>;
</span><span class="l" id="128">128                 }
</span><span class="l" id="129">129                 <span class="php-keyword1">if</span> (<span class="php-quote">"\r"</span> !== <span class="php-var">$char</span>) {
</span><span class="l" id="130">130                     <span class="php-comment">// build line; \r is ignored</span>
</span><span class="l" id="131">131                     <span class="php-var">$line</span> = <span class="php-var">$char</span> . <span class="php-var">$line</span>;
</span><span class="l" id="132">132                 }
</span><span class="l" id="133">133             }
</span><span class="l" id="134">134             <span class="php-var">$this</span>-&gt;<span class="php-keyword2">pos</span> -= <span class="php-var">$bufferSize</span>;
</span><span class="l" id="135">135         }
</span><span class="l" id="136">136         <span class="php-keyword1">if</span> (!<span class="php-var">$line</span> = <span class="php-keyword2">trim</span>(<span class="php-var">$line</span>)) {
</span><span class="l" id="137">137             <span class="php-comment">// empty lines are skipped -&gt; read next line</span>
</span><span class="l" id="138">138             <span class="php-var">$this</span>-&gt;<span class="php-keyword2">next</span>();
</span><span class="l" id="139">139             <span class="php-keyword1">return</span>;
</span><span class="l" id="140">140         }
</span><span class="l" id="141">141         <span class="php-comment">// found a non-empty line</span>
</span><span class="l" id="142">142         ++<span class="php-var">$this</span>-&gt;<span class="php-keyword2">key</span>;
</span><span class="l" id="143">143         <span class="php-var">$this</span>-&gt;currentLine = <span class="php-var">$line</span>;
</span><span class="l" id="144">144     }
</span><span class="l" id="145">145 
</span><span class="l" id="146">146     <span class="php-comment">/**
</span></span><span class="l" id="147">147 <span class="php-comment">     * {@inheritdoc}
</span></span><span class="l" id="148">148 <span class="php-comment">     */</span>
</span><span class="l" id="149">149     <span class="php-keyword1">public</span> <span class="php-keyword1">function</span> <span class="php-keyword2">key</span>()
</span><span class="l" id="150">150     {
</span><span class="l" id="151">151         <span class="php-keyword1">return</span> <span class="php-var">$this</span>-&gt;<span class="php-keyword2">key</span>;
</span><span class="l" id="152">152     }
</span><span class="l" id="153">153 
</span><span class="l" id="154">154     <span class="php-comment">/**
</span></span><span class="l" id="155">155 <span class="php-comment">     * {@inheritdoc}
</span></span><span class="l" id="156">156 <span class="php-comment">     */</span>
</span><span class="l" id="157">157     <span class="php-keyword1">public</span> <span class="php-keyword1">function</span> valid()
</span><span class="l" id="158">158     {
</span><span class="l" id="159">159         <span class="php-keyword1">return</span> !<span class="php-keyword1">empty</span>(<span class="php-var">$this</span>-&gt;currentLine);
</span><span class="l" id="160">160     }
</span><span class="l" id="161">161 
</span><span class="l" id="162">162     <span class="php-comment">/**
</span></span><span class="l" id="163">163 <span class="php-comment">     * {@inheritdoc}
</span></span><span class="l" id="164">164 <span class="php-comment">     */</span>
</span><span class="l" id="165">165     <span class="php-keyword1">public</span> <span class="php-keyword1">function</span> <span class="php-keyword2">rewind</span>()
</span><span class="l" id="166">166     {
</span><span class="l" id="167">167         <span class="php-var">$this</span>-&gt;second = <span class="php-keyword1">false</span>;
</span><span class="l" id="168">168         <span class="php-var">$this</span>-&gt;<span class="php-keyword2">pos</span> = <span class="php-keyword1">null</span>;
</span><span class="l" id="169">169         <span class="php-var">$this</span>-&gt;<span class="php-keyword2">key</span> = -<span class="php-num">1</span>;
</span><span class="l" id="170">170         <span class="php-var">$this</span>-&gt;bufferPos = -<span class="php-num">1</span>;
</span><span class="l" id="171">171         <span class="php-var">$this</span>-&gt;<span class="php-keyword2">next</span>();
</span><span class="l" id="172">172     }
</span><span class="l" id="173">173 
</span><span class="l" id="174">174     <span class="php-comment">/**
</span></span><span class="l" id="175">175 <span class="php-comment">     * Deletes a log file and its rotations.
</span></span><span class="l" id="176">176 <span class="php-comment">     *
</span></span><span class="l" id="177">177 <span class="php-comment">     * @param string $path File path
</span></span><span class="l" id="178">178 <span class="php-comment">     *
</span></span><span class="l" id="179">179 <span class="php-comment">     * @return bool
</span></span><span class="l" id="180">180 <span class="php-comment">     */</span>
</span><span class="l" id="181">181     <span class="php-keyword1">public</span> <span class="php-keyword1">static</span> <span class="php-keyword1">function</span> <span class="php-keyword2">delete</span>(<span class="php-var">$path</span>)
</span><span class="l" id="182">182     {
</span><span class="l" id="183">183         <span class="php-keyword1">return</span> rex_file::<span class="php-keyword2">delete</span>(<span class="php-var">$path</span>) &amp;&amp; rex_file::<span class="php-keyword2">delete</span>(<span class="php-var">$path</span> . <span class="php-quote">'.2'</span>);
</span><span class="l" id="184">184     }
</span><span class="l" id="185">185 }
</span><span class="l" id="186">186 
</span><span class="l" id="187">187 <span class="php-comment">/**
</span></span><span class="l" id="188">188 <span class="php-comment"> * Log entry class.
</span></span><span class="l" id="189">189 <span class="php-comment"> *
</span></span><span class="l" id="190">190 <span class="php-comment"> * @author gharlan
</span></span><span class="l" id="191">191 <span class="php-comment"> *
</span></span><span class="l" id="192">192 <span class="php-comment"> * @package redaxo\core
</span></span><span class="l" id="193">193 <span class="php-comment"> */</span>
</span><span class="l" id="194">194 <span class="php-keyword1">class</span> rex_log_entry
</span><span class="l" id="195">195 {
</span><span class="l" id="196">196     <span class="php-comment">/** @var int */</span>
</span><span class="l" id="197">197     <span class="php-keyword1">private</span> <span class="php-var">$timestamp</span>;
</span><span class="l" id="198">198 
</span><span class="l" id="199">199     <span class="php-comment">/** @var array */</span>
</span><span class="l" id="200">200     <span class="php-keyword1">private</span> <span class="php-var">$data</span>;
</span><span class="l" id="201">201 
</span><span class="l" id="202">202     <span class="php-comment">/**
</span></span><span class="l" id="203">203 <span class="php-comment">     * Constructor.
</span></span><span class="l" id="204">204 <span class="php-comment">     *
</span></span><span class="l" id="205">205 <span class="php-comment">     * @param int   $timestamp Timestamp
</span></span><span class="l" id="206">206 <span class="php-comment">     * @param array $data      Log data
</span></span><span class="l" id="207">207 <span class="php-comment">     */</span>
</span><span class="l" id="208">208     <span class="php-keyword1">public</span> <span class="php-keyword1">function</span> __construct(<span class="php-var">$timestamp</span>, <span class="php-keyword1">array</span> <span class="php-var">$data</span>)
</span><span class="l" id="209">209     {
</span><span class="l" id="210">210         <span class="php-var">$this</span>-&gt;timestamp = <span class="php-var">$timestamp</span>;
</span><span class="l" id="211">211         <span class="php-var">$this</span>-&gt;data = <span class="php-var">$data</span>;
</span><span class="l" id="212">212     }
</span><span class="l" id="213">213 
</span><span class="l" id="214">214     <span class="php-comment">/**
</span></span><span class="l" id="215">215 <span class="php-comment">     * Creates a log entry from string.
</span></span><span class="l" id="216">216 <span class="php-comment">     *
</span></span><span class="l" id="217">217 <span class="php-comment">     * @param string $string Log line
</span></span><span class="l" id="218">218 <span class="php-comment">     *
</span></span><span class="l" id="219">219 <span class="php-comment">     * @return rex_log_entry
</span></span><span class="l" id="220">220 <span class="php-comment">     */</span>
</span><span class="l" id="221">221     <span class="php-keyword1">public</span> <span class="php-keyword1">static</span> <span class="php-keyword1">function</span> createFromString(<span class="php-var">$string</span>)
</span><span class="l" id="222">222     {
</span><span class="l" id="223">223         <span class="php-keyword1">foreach</span> (<span class="php-keyword2">explode</span>(<span class="php-quote">'|'</span>, <span class="php-var">$string</span>) <span class="php-keyword1">as</span> <span class="php-var">$part</span>) {
</span><span class="l" id="224">224             <span class="php-var">$data</span>[] = <span class="php-keyword2">str_replace</span>(<span class="php-quote">'\n'</span>, <span class="php-quote">"\n"</span>, <span class="php-keyword2">trim</span>(<span class="php-var">$part</span>));
</span><span class="l" id="225">225         }
</span><span class="l" id="226">226 
</span><span class="l" id="227">227         <span class="php-var">$timestamp</span> = <span class="php-keyword2">strtotime</span>(<span class="php-keyword2">array_shift</span>(<span class="php-var">$data</span>));
</span><span class="l" id="228">228 
</span><span class="l" id="229">229         <span class="php-keyword1">return</span> <span class="php-keyword1">new</span> self(<span class="php-var">$timestamp</span>, <span class="php-var">$data</span>);
</span><span class="l" id="230">230     }
</span><span class="l" id="231">231 
</span><span class="l" id="232">232     <span class="php-comment">/**
</span></span><span class="l" id="233">233 <span class="php-comment">     * Returns the timestamp.
</span></span><span class="l" id="234">234 <span class="php-comment">     *
</span></span><span class="l" id="235">235 <span class="php-comment">     * @param string $format See {@link rex_formatter::strftime}
</span></span><span class="l" id="236">236 <span class="php-comment">     *
</span></span><span class="l" id="237">237 <span class="php-comment">     * @return int|string Unix timestamp or formatted string if $format is given
</span></span><span class="l" id="238">238 <span class="php-comment">     */</span>
</span><span class="l" id="239">239     <span class="php-keyword1">public</span> <span class="php-keyword1">function</span> getTimestamp(<span class="php-var">$format</span> = <span class="php-keyword1">null</span>)
</span><span class="l" id="240">240     {
</span><span class="l" id="241">241         <span class="php-keyword1">if</span> (<span class="php-keyword1">null</span> === <span class="php-var">$format</span>) {
</span><span class="l" id="242">242             <span class="php-keyword1">return</span> <span class="php-var">$this</span>-&gt;timestamp;
</span><span class="l" id="243">243         }
</span><span class="l" id="244">244         <span class="php-keyword1">return</span> rex_formatter::<span class="php-keyword2">strftime</span>(<span class="php-var">$this</span>-&gt;timestamp, <span class="php-var">$format</span>);
</span><span class="l" id="245">245     }
</span><span class="l" id="246">246 
</span><span class="l" id="247">247     <span class="php-comment">/**
</span></span><span class="l" id="248">248 <span class="php-comment">     * Returns the log data.
</span></span><span class="l" id="249">249 <span class="php-comment">     *
</span></span><span class="l" id="250">250 <span class="php-comment">     * @return array
</span></span><span class="l" id="251">251 <span class="php-comment">     */</span>
</span><span class="l" id="252">252     <span class="php-keyword1">public</span> <span class="php-keyword1">function</span> getData()
</span><span class="l" id="253">253     {
</span><span class="l" id="254">254         <span class="php-keyword1">return</span> <span class="php-var">$this</span>-&gt;data;
</span><span class="l" id="255">255     }
</span><span class="l" id="256">256 
</span><span class="l" id="257">257     <span class="php-comment">/**
</span></span><span class="l" id="258">258 <span class="php-comment">     * @return string
</span></span><span class="l" id="259">259 <span class="php-comment">     */</span>
</span><span class="l" id="260">260     <span class="php-keyword1">public</span> <span class="php-keyword1">function</span> __toString()
</span><span class="l" id="261">261     {
</span><span class="l" id="262">262         <span class="php-var">$data</span> = <span class="php-keyword2">implode</span>(<span class="php-quote">' | '</span>, <span class="php-keyword2">array_map</span>(<span class="php-quote">'trim'</span>, <span class="php-var">$this</span>-&gt;data));
</span><span class="l" id="263">263         <span class="php-var">$data</span> = <span class="php-keyword2">str_replace</span>([<span class="php-quote">"\r"</span>, <span class="php-quote">"\n"</span>], [<span class="php-quote">''</span>, <span class="php-quote">'\n'</span>], <span class="php-var">$data</span>);
</span><span class="l" id="264">264         <span class="php-keyword1">return</span> <span class="php-keyword2">date</span>(<span class="php-quote">'Y-m-d H:i:s'</span>, <span class="php-var">$this</span>-&gt;timestamp) . <span class="php-quote">' | '</span> . <span class="php-var">$data</span>;
</span><span class="l" id="265">265     }
</span><span class="l" id="266">266 }
</span><span class="l" id="267">267 </span></code></pre>
 </body>
</html>
