<!DOCTYPE html>
<html lang="de">
 <head>
  <meta charset="utf-8"/>
  <link href="../Assets/css/styles.css" rel="stylesheet"/>
  <script src="../Assets/js/script.js">
  </script>
 </head>
 <body>
  <pre id="source"><code><span class="l" id="1">  1 <span class="xlang">&lt;?php</span>
</span><span class="l" id="2">  2 
</span><span class="l" id="3">  3 <span class="php-comment">/**
</span></span><span class="l" id="4">  4 <span class="php-comment"> * MetaForm Addon.
</span></span><span class="l" id="5">  5 <span class="php-comment"> *
</span></span><span class="l" id="6">  6 <span class="php-comment"> * @author markus[dot]staab[at]redaxo[dot]de Markus Staab
</span></span><span class="l" id="7">  7 <span class="php-comment"> *
</span></span><span class="l" id="8">  8 <span class="php-comment"> * @package redaxo\metainfo
</span></span><span class="l" id="9">  9 <span class="php-comment"> */</span>
</span><span class="l" id="10"> 10 
</span><span class="l" id="11"> 11 <span class="php-comment">/**
</span></span><span class="l" id="12"> 12 <span class="php-comment"> * Fügt einen neuen Feldtyp ein.
</span></span><span class="l" id="13"> 13 <span class="php-comment"> *
</span></span><span class="l" id="14"> 14 <span class="php-comment"> * Gibt beim Erfolg die Id des Feldes zurück, bei Fehler die Fehlermeldung
</span></span><span class="l" id="15"> 15 <span class="php-comment"> */</span>
</span><span class="l" id="16"> 16 <span class="php-keyword1">function</span> rex_metainfo_add_field_type(<span class="php-var">$label</span>, <span class="php-var">$dbtype</span>, <span class="php-var">$dblength</span>)
</span><span class="l" id="17"> 17 {
</span><span class="l" id="18"> 18     <span class="php-keyword1">if</span> (!<span class="php-keyword2">is_string</span>(<span class="php-var">$label</span>) || <span class="php-keyword1">empty</span>(<span class="php-var">$label</span>)) {
</span><span class="l" id="19"> 19         <span class="php-keyword1">return</span> rex_i18n::msg(<span class="php-quote">'minfo_field_error_invalid_name'</span>);
</span><span class="l" id="20"> 20     }
</span><span class="l" id="21"> 21 
</span><span class="l" id="22"> 22     <span class="php-keyword1">if</span> (!<span class="php-keyword2">is_string</span>(<span class="php-var">$dbtype</span>) || <span class="php-keyword1">empty</span>(<span class="php-var">$dbtype</span>)) {
</span><span class="l" id="23"> 23         <span class="php-keyword1">return</span> rex_i18n::msg(<span class="php-quote">'minfo_field_error_invalid_type'</span>);
</span><span class="l" id="24"> 24     }
</span><span class="l" id="25"> 25 
</span><span class="l" id="26"> 26     <span class="php-keyword1">if</span> (!<span class="php-keyword2">is_int</span>(<span class="php-var">$dblength</span>) || <span class="php-keyword1">empty</span>(<span class="php-var">$dblength</span>)) {
</span><span class="l" id="27"> 27         <span class="php-keyword1">return</span> rex_i18n::msg(<span class="php-quote">'minfo_field_error_invalid_length'</span>);
</span><span class="l" id="28"> 28     }
</span><span class="l" id="29"> 29 
</span><span class="l" id="30"> 30     <span class="php-var">$qry</span> = <span class="php-quote">'SELECT * FROM '</span> . rex::getTablePrefix() . <span class="php-quote">'metainfo_type WHERE label=:label LIMIT 1'</span>;
</span><span class="l" id="31"> 31     <span class="php-var">$sql</span> = rex_sql::factory();
</span><span class="l" id="32"> 32     <span class="php-var">$sql</span>-&gt;setQuery(<span class="php-var">$qry</span>, [<span class="php-quote">':label'</span> =&gt; <span class="php-var">$label</span>]);
</span><span class="l" id="33"> 33     <span class="php-keyword1">if</span> (<span class="php-var">$sql</span>-&gt;getRows() != <span class="php-num">0</span>) {
</span><span class="l" id="34"> 34         <span class="php-keyword1">return</span> rex_i18n::msg(<span class="php-quote">'minfo_field_error_unique_type'</span>);
</span><span class="l" id="35"> 35     }
</span><span class="l" id="36"> 36 
</span><span class="l" id="37"> 37     <span class="php-var">$sql</span>-&gt;setTable(rex::getTablePrefix() . <span class="php-quote">'metainfo_type'</span>);
</span><span class="l" id="38"> 38     <span class="php-var">$sql</span>-&gt;setValue(<span class="php-quote">'label'</span>, <span class="php-var">$label</span>);
</span><span class="l" id="39"> 39     <span class="php-var">$sql</span>-&gt;setValue(<span class="php-quote">'dbtype'</span>, <span class="php-var">$dbtype</span>);
</span><span class="l" id="40"> 40     <span class="php-var">$sql</span>-&gt;setValue(<span class="php-quote">'dblength'</span>, <span class="php-var">$dblength</span>);
</span><span class="l" id="41"> 41 
</span><span class="l" id="42"> 42     <span class="php-var">$sql</span>-&gt;insert();
</span><span class="l" id="43"> 43     <span class="php-keyword1">return</span> <span class="php-var">$sql</span>-&gt;getLastId();
</span><span class="l" id="44"> 44 }
</span><span class="l" id="45"> 45 
</span><span class="l" id="46"> 46 <span class="php-comment">/**
</span></span><span class="l" id="47"> 47 <span class="php-comment"> * Löscht einen Feldtyp.
</span></span><span class="l" id="48"> 48 <span class="php-comment"> *
</span></span><span class="l" id="49"> 49 <span class="php-comment"> * Gibt beim Erfolg true zurück, sonst eine Fehlermeldung
</span></span><span class="l" id="50"> 50 <span class="php-comment"> */</span>
</span><span class="l" id="51"> 51 <span class="php-keyword1">function</span> rex_metainfo_delete_field_type(<span class="php-var">$field_type_id</span>)
</span><span class="l" id="52"> 52 {
</span><span class="l" id="53"> 53     <span class="php-keyword1">if</span> (!<span class="php-keyword2">is_int</span>(<span class="php-var">$field_type_id</span>) || <span class="php-keyword1">empty</span>(<span class="php-var">$field_type_id</span>)) {
</span><span class="l" id="54"> 54         <span class="php-keyword1">return</span> rex_i18n::msg(<span class="php-quote">'minfo_field_error_invalid_typeid'</span>);
</span><span class="l" id="55"> 55     }
</span><span class="l" id="56"> 56 
</span><span class="l" id="57"> 57     <span class="php-var">$sql</span> = rex_sql::factory();
</span><span class="l" id="58"> 58     <span class="php-var">$sql</span>-&gt;setTable(rex::getTablePrefix() . <span class="php-quote">'metainfo_type'</span>);
</span><span class="l" id="59"> 59     <span class="php-var">$sql</span>-&gt;setWhere([<span class="php-quote">'id'</span> =&gt; <span class="php-var">$field_type_id</span>]);
</span><span class="l" id="60"> 60 
</span><span class="l" id="61"> 61     <span class="php-var">$sql</span>-&gt;<span class="php-keyword2">delete</span>();
</span><span class="l" id="62"> 62     <span class="php-keyword1">return</span> <span class="php-var">$sql</span>-&gt;getRows() == <span class="php-num">1</span>;
</span><span class="l" id="63"> 63 }
</span><span class="l" id="64"> 64 
</span><span class="l" id="65"> 65 <span class="php-comment">/**
</span></span><span class="l" id="66"> 66 <span class="php-comment"> * Fügt ein MetaFeld hinzu und legt dafür eine Spalte in der MetaTable an.
</span></span><span class="l" id="67"> 67 <span class="php-comment"> */</span>
</span><span class="l" id="68"> 68 <span class="php-keyword1">function</span> rex_metainfo_add_field(<span class="php-var">$title</span>, <span class="php-var">$name</span>, <span class="php-var">$priority</span>, <span class="php-var">$attributes</span>, <span class="php-var">$type</span>, <span class="php-var">$default</span>, <span class="php-var">$params</span> = <span class="php-keyword1">null</span>, <span class="php-var">$validate</span> = <span class="php-keyword1">null</span>, <span class="php-var">$restrictions</span> = <span class="php-quote">''</span>, <span class="php-var">$callback</span> = <span class="php-keyword1">null</span>)
</span><span class="l" id="69"> 69 {
</span><span class="l" id="70"> 70     <span class="php-var">$prefix</span> = rex_metainfo_meta_prefix(<span class="php-var">$name</span>);
</span><span class="l" id="71"> 71     <span class="php-var">$metaTable</span> = rex_metainfo_meta_table(<span class="php-var">$prefix</span>);
</span><span class="l" id="72"> 72 
</span><span class="l" id="73"> 73     <span class="php-comment">// Prefix korrekt?</span>
</span><span class="l" id="74"> 74     <span class="php-keyword1">if</span> (!<span class="php-var">$metaTable</span>) {
</span><span class="l" id="75"> 75         <span class="php-keyword1">return</span> rex_i18n::msg(<span class="php-quote">'minfo_field_error_invalid_prefix'</span>);
</span><span class="l" id="76"> 76     }
</span><span class="l" id="77"> 77 
</span><span class="l" id="78"> 78     <span class="php-comment">// TypeId korrekt?</span>
</span><span class="l" id="79"> 79     <span class="php-var">$qry</span> = <span class="php-quote">'SELECT * FROM '</span> . rex::getTablePrefix() . <span class="php-quote">'metainfo_type WHERE id='</span> . <span class="php-var">$type</span> . <span class="php-quote">' LIMIT 2'</span>;
</span><span class="l" id="80"> 80     <span class="php-var">$sql</span> = rex_sql::factory();
</span><span class="l" id="81"> 81     <span class="php-var">$typeInfos</span> = <span class="php-var">$sql</span>-&gt;getArray(<span class="php-var">$qry</span>);
</span><span class="l" id="82"> 82 
</span><span class="l" id="83"> 83     <span class="php-keyword1">if</span> (<span class="php-var">$sql</span>-&gt;getRows() != <span class="php-num">1</span>) {
</span><span class="l" id="84"> 84         <span class="php-keyword1">return</span> rex_i18n::msg(<span class="php-quote">'minfo_field_error_invalid_type'</span>);
</span><span class="l" id="85"> 85     }
</span><span class="l" id="86"> 86 
</span><span class="l" id="87"> 87     <span class="php-var">$fieldDbType</span> = <span class="php-var">$typeInfos</span>[<span class="php-num">0</span>][<span class="php-quote">'dbtype'</span>];
</span><span class="l" id="88"> 88     <span class="php-var">$fieldDbLength</span> = <span class="php-var">$typeInfos</span>[<span class="php-num">0</span>][<span class="php-quote">'dblength'</span>];
</span><span class="l" id="89"> 89 
</span><span class="l" id="90"> 90     <span class="php-comment">// Spalte existiert schon?</span>
</span><span class="l" id="91"> 91     <span class="php-var">$sql</span>-&gt;setQuery(<span class="php-quote">'SELECT * FROM '</span> . <span class="php-var">$metaTable</span> . <span class="php-quote">' LIMIT 1'</span>);
</span><span class="l" id="92"> 92     <span class="php-keyword1">if</span> (<span class="php-keyword2">in_array</span>(<span class="php-var">$name</span>, <span class="php-var">$sql</span>-&gt;getFieldnames())) {
</span><span class="l" id="93"> 93         <span class="php-keyword1">return</span> rex_i18n::msg(<span class="php-quote">'minfo_field_error_unique_name'</span>);
</span><span class="l" id="94"> 94     }
</span><span class="l" id="95"> 95 
</span><span class="l" id="96"> 96     <span class="php-comment">// Spalte extiert laut metainfo_field?</span>
</span><span class="l" id="97"> 97     <span class="php-var">$qry</span> = <span class="php-quote">'SELECT * FROM '</span> . rex::getTablePrefix() . <span class="php-quote">'metainfo_field WHERE name=:name LIMIT 1'</span>;
</span><span class="l" id="98"> 98     <span class="php-var">$sql</span> = rex_sql::factory();
</span><span class="l" id="99"> 99     <span class="php-var">$sql</span>-&gt;setQuery(<span class="php-var">$qry</span>, [<span class="php-quote">':name'</span> =&gt; <span class="php-var">$name</span>]);
</span><span class="l" id="100">100     <span class="php-keyword1">if</span> (<span class="php-var">$sql</span>-&gt;getRows() != <span class="php-num">0</span>) {
</span><span class="l" id="101">101         <span class="php-keyword1">return</span> rex_i18n::msg(<span class="php-quote">'minfo_field_error_unique_name'</span>);
</span><span class="l" id="102">102     }
</span><span class="l" id="103">103 
</span><span class="l" id="104">104     <span class="php-var">$sql</span>-&gt;setTable(rex::getTablePrefix() . <span class="php-quote">'metainfo_field'</span>);
</span><span class="l" id="105">105     <span class="php-var">$sql</span>-&gt;setValue(<span class="php-quote">'title'</span>, <span class="php-var">$title</span>);
</span><span class="l" id="106">106     <span class="php-var">$sql</span>-&gt;setValue(<span class="php-quote">'name'</span>, <span class="php-var">$name</span>);
</span><span class="l" id="107">107     <span class="php-var">$sql</span>-&gt;setValue(<span class="php-quote">'priority'</span>, <span class="php-var">$priority</span>);
</span><span class="l" id="108">108     <span class="php-var">$sql</span>-&gt;setValue(<span class="php-quote">'attributes'</span>, <span class="php-var">$attributes</span>);
</span><span class="l" id="109">109     <span class="php-var">$sql</span>-&gt;setValue(<span class="php-quote">'type_id'</span>, <span class="php-var">$type</span>);
</span><span class="l" id="110">110     <span class="php-var">$sql</span>-&gt;setValue(<span class="php-quote">'default'</span>, <span class="php-var">$default</span>);
</span><span class="l" id="111">111     <span class="php-var">$sql</span>-&gt;setValue(<span class="php-quote">'params'</span>, <span class="php-var">$params</span>);
</span><span class="l" id="112">112     <span class="php-var">$sql</span>-&gt;setValue(<span class="php-quote">'validate'</span>, <span class="php-var">$validate</span>);
</span><span class="l" id="113">113     <span class="php-var">$sql</span>-&gt;setValue(<span class="php-quote">'restrictions'</span>, <span class="php-var">$restrictions</span>);
</span><span class="l" id="114">114     <span class="php-var">$sql</span>-&gt;setValue(<span class="php-quote">'callback'</span>, <span class="php-var">$callback</span>);
</span><span class="l" id="115">115     <span class="php-var">$sql</span>-&gt;addGlobalUpdateFields();
</span><span class="l" id="116">116     <span class="php-var">$sql</span>-&gt;addGlobalCreateFields();
</span><span class="l" id="117">117 
</span><span class="l" id="118">118     <span class="php-var">$sql</span>-&gt;insert();
</span><span class="l" id="119">119 
</span><span class="l" id="120">120     <span class="php-comment">// replace LIKE wildcards</span>
</span><span class="l" id="121">121     <span class="php-var">$prefix</span> = <span class="php-keyword2">str_replace</span>([<span class="php-quote">'_'</span>, <span class="php-quote">'%'</span>], [<span class="php-quote">'\_'</span>, <span class="php-quote">'\%'</span>], <span class="php-var">$prefix</span>);
</span><span class="l" id="122">122 
</span><span class="l" id="123">123     rex_sql_util::organizePriorities(rex::getTablePrefix() . <span class="php-quote">'metainfo_field'</span>, <span class="php-quote">'priority'</span>, <span class="php-quote">'name LIKE "'</span> . <span class="php-var">$prefix</span> . <span class="php-quote">'%"'</span>, <span class="php-quote">'priority, updatedate'</span>);
</span><span class="l" id="124">124 
</span><span class="l" id="125">125     <span class="php-var">$tableManager</span> = <span class="php-keyword1">new</span> rex_metainfo_table_manager(<span class="php-var">$metaTable</span>);
</span><span class="l" id="126">126     <span class="php-keyword1">return</span> <span class="php-var">$tableManager</span>-&gt;addColumn(<span class="php-var">$name</span>, <span class="php-var">$fieldDbType</span>, <span class="php-var">$fieldDbLength</span>, <span class="php-var">$default</span>);
</span><span class="l" id="127">127 }
</span><span class="l" id="128">128 
</span><span class="l" id="129">129 <span class="php-keyword1">function</span> rex_metainfo_delete_field(<span class="php-var">$fieldIdOrName</span>)
</span><span class="l" id="130">130 {
</span><span class="l" id="131">131     <span class="php-comment">// Löschen anhand der FieldId</span>
</span><span class="l" id="132">132     <span class="php-keyword1">if</span> (<span class="php-keyword2">is_int</span>(<span class="php-var">$fieldIdOrName</span>)) {
</span><span class="l" id="133">133         <span class="php-var">$fieldQry</span> = <span class="php-quote">'SELECT * FROM '</span> . rex::getTablePrefix() . <span class="php-quote">'metainfo_field WHERE id=:idOrName LIMIT 2'</span>;
</span><span class="l" id="134">134         <span class="php-var">$invalidField</span> = rex_i18n::msg(<span class="php-quote">'minfo_field_error_invalid_fieldid'</span>);
</span><span class="l" id="135">135     }
</span><span class="l" id="136">136     <span class="php-comment">// Löschen anhand des Feldnames</span>
</span><span class="l" id="137">137     <span class="php-keyword1">elseif</span> (<span class="php-keyword2">is_string</span>(<span class="php-var">$fieldIdOrName</span>)) {
</span><span class="l" id="138">138         <span class="php-var">$fieldQry</span> = <span class="php-quote">'SELECT * FROM '</span> . rex::getTablePrefix() . <span class="php-quote">'metainfo_field WHERE name=:idOrName LIMIT 2'</span>;
</span><span class="l" id="139">139         <span class="php-var">$invalidField</span> = rex_i18n::msg(<span class="php-quote">'minfo_field_error_invalid_name'</span>);
</span><span class="l" id="140">140     } <span class="php-keyword1">else</span> {
</span><span class="l" id="141">141         <span class="php-keyword1">throw</span> <span class="php-keyword1">new</span> InvalidArgumentException(<span class="php-quote">'MetaInfos: Unexpected type for $fieldIdOrName!'</span>);
</span><span class="l" id="142">142     }
</span><span class="l" id="143">143     <span class="php-comment">// Feld existiert?</span>
</span><span class="l" id="144">144     <span class="php-var">$sql</span> = rex_sql::factory();
</span><span class="l" id="145">145     <span class="php-var">$sql</span>-&gt;setQuery(<span class="php-var">$fieldQry</span>, [<span class="php-quote">':idOrName'</span> =&gt; <span class="php-var">$fieldIdOrName</span>]);
</span><span class="l" id="146">146 
</span><span class="l" id="147">147     <span class="php-keyword1">if</span> (<span class="php-var">$sql</span>-&gt;getRows() != <span class="php-num">1</span>) {
</span><span class="l" id="148">148         <span class="php-keyword1">return</span> <span class="php-var">$invalidField</span>;
</span><span class="l" id="149">149     }
</span><span class="l" id="150">150 
</span><span class="l" id="151">151     <span class="php-var">$name</span> = <span class="php-var">$sql</span>-&gt;getValue(<span class="php-quote">'name'</span>);
</span><span class="l" id="152">152     <span class="php-var">$field_id</span> = <span class="php-var">$sql</span>-&gt;getValue(<span class="php-quote">'id'</span>);
</span><span class="l" id="153">153 
</span><span class="l" id="154">154     <span class="php-var">$prefix</span> = rex_metainfo_meta_prefix(<span class="php-var">$name</span>);
</span><span class="l" id="155">155     <span class="php-var">$metaTable</span> = rex_metainfo_meta_table(<span class="php-var">$prefix</span>);
</span><span class="l" id="156">156 
</span><span class="l" id="157">157     <span class="php-comment">// Spalte existiert?</span>
</span><span class="l" id="158">158     <span class="php-var">$sql</span>-&gt;setQuery(<span class="php-quote">'SELECT * FROM '</span> . <span class="php-var">$metaTable</span> . <span class="php-quote">' LIMIT 1'</span>);
</span><span class="l" id="159">159     <span class="php-keyword1">if</span> (!<span class="php-keyword2">in_array</span>(<span class="php-var">$name</span>, <span class="php-var">$sql</span>-&gt;getFieldnames())) {
</span><span class="l" id="160">160         <span class="php-keyword1">return</span> rex_i18n::msg(<span class="php-quote">'minfo_field_error_invalid_name'</span>);
</span><span class="l" id="161">161     }
</span><span class="l" id="162">162 
</span><span class="l" id="163">163     <span class="php-var">$sql</span>-&gt;setTable(rex::getTablePrefix() . <span class="php-quote">'metainfo_field'</span>);
</span><span class="l" id="164">164     <span class="php-var">$sql</span>-&gt;setWhere([<span class="php-quote">'id'</span> =&gt; <span class="php-var">$field_id</span>]);
</span><span class="l" id="165">165 
</span><span class="l" id="166">166     <span class="php-var">$sql</span>-&gt;<span class="php-keyword2">delete</span>();
</span><span class="l" id="167">167 
</span><span class="l" id="168">168     <span class="php-var">$tableManager</span> = <span class="php-keyword1">new</span> rex_metainfo_table_manager(<span class="php-var">$metaTable</span>);
</span><span class="l" id="169">169     <span class="php-keyword1">return</span> <span class="php-var">$tableManager</span>-&gt;deleteColumn(<span class="php-var">$name</span>);
</span><span class="l" id="170">170 }
</span><span class="l" id="171">171 
</span><span class="l" id="172">172 <span class="php-comment">/**
</span></span><span class="l" id="173">173 <span class="php-comment"> * Extrahiert den Prefix aus dem Namen eine Spalte.
</span></span><span class="l" id="174">174 <span class="php-comment"> */</span>
</span><span class="l" id="175">175 <span class="php-keyword1">function</span> rex_metainfo_meta_prefix(<span class="php-var">$name</span>)
</span><span class="l" id="176">176 {
</span><span class="l" id="177">177     <span class="php-keyword1">if</span> (!<span class="php-keyword2">is_string</span>(<span class="php-var">$name</span>)) {
</span><span class="l" id="178">178         <span class="php-keyword1">return</span> <span class="php-keyword1">false</span>;
</span><span class="l" id="179">179     }
</span><span class="l" id="180">180 
</span><span class="l" id="181">181     <span class="php-keyword1">if</span> ((<span class="php-var">$pos</span> = <span class="php-keyword2">strpos</span>(<span class="php-var">$name</span>, <span class="php-quote">'_'</span>)) !== <span class="php-keyword1">false</span>) {
</span><span class="l" id="182">182         <span class="php-keyword1">return</span> <span class="php-keyword2">substr</span>(<span class="php-keyword2">strtolower</span>(<span class="php-var">$name</span>), <span class="php-num">0</span>, <span class="php-var">$pos</span> + <span class="php-num">1</span>);
</span><span class="l" id="183">183     }
</span><span class="l" id="184">184 
</span><span class="l" id="185">185     <span class="php-keyword1">return</span> <span class="php-keyword1">false</span>;
</span><span class="l" id="186">186 }
</span><span class="l" id="187">187 
</span><span class="l" id="188">188 <span class="php-comment">/**
</span></span><span class="l" id="189">189 <span class="php-comment"> * Gibt die mit dem Prefix verbundenen Tabellennamen zurück.
</span></span><span class="l" id="190">190 <span class="php-comment"> */</span>
</span><span class="l" id="191">191 <span class="php-keyword1">function</span> rex_metainfo_meta_table(<span class="php-var">$prefix</span>)
</span><span class="l" id="192">192 {
</span><span class="l" id="193">193     <span class="php-var">$metaTables</span> = rex_addon::get(<span class="php-quote">'metainfo'</span>)-&gt;getProperty(<span class="php-quote">'metaTables'</span>, []);
</span><span class="l" id="194">194 
</span><span class="l" id="195">195     <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$metaTables</span>[<span class="php-var">$prefix</span>])) {
</span><span class="l" id="196">196         <span class="php-keyword1">return</span> <span class="php-var">$metaTables</span>[<span class="php-var">$prefix</span>];
</span><span class="l" id="197">197     }
</span><span class="l" id="198">198 
</span><span class="l" id="199">199     <span class="php-keyword1">return</span> <span class="php-keyword1">false</span>;
</span><span class="l" id="200">200 }
</span><span class="l" id="201">201 
</span><span class="l" id="202">202 <span class="php-comment">/**
</span></span><span class="l" id="203">203 <span class="php-comment"> * Bindet ggf extensions ein.
</span></span><span class="l" id="204">204 <span class="php-comment"> *
</span></span><span class="l" id="205">205 <span class="php-comment"> * @param rex_extension_point $ep
</span></span><span class="l" id="206">206 <span class="php-comment"> */</span>
</span><span class="l" id="207">207 <span class="php-keyword1">function</span> rex_metainfo_extensions_handler(rex_extension_point <span class="php-var">$ep</span>)
</span><span class="l" id="208">208 {
</span><span class="l" id="209">209     <span class="php-var">$page</span> = <span class="php-var">$ep</span>-&gt;getSubject();
</span><span class="l" id="210">210     <span class="php-var">$mainpage</span> = rex_be_controller::getCurrentPagePart(<span class="php-num">1</span>);
</span><span class="l" id="211">211     <span class="php-var">$mypage</span> = <span class="php-quote">'metainfo'</span>;
</span><span class="l" id="212">212 
</span><span class="l" id="213">213     <span class="php-comment">// additional javascripts</span>
</span><span class="l" id="214">214     <span class="php-keyword1">if</span> (<span class="php-var">$mainpage</span> == <span class="php-quote">'metainfo'</span> || <span class="php-var">$page</span> == <span class="php-quote">'content/metainfo'</span> || <span class="php-var">$page</span> == <span class="php-quote">'structure'</span> || <span class="php-var">$page</span> == <span class="php-quote">'system/lang'</span>) {
</span><span class="l" id="215">215         rex_view::addJsFile(rex_url::addonAssets(<span class="php-var">$mypage</span>, <span class="php-quote">'metainfo.js'</span>));
</span><span class="l" id="216">216     }
</span><span class="l" id="217">217 
</span><span class="l" id="218">218     <span class="php-comment">// include extensions</span>
</span><span class="l" id="219">219     <span class="php-var">$curDir</span> = __DIR__ . <span class="php-quote">'/..'</span>;
</span><span class="l" id="220">220     <span class="php-keyword1">if</span> (<span class="php-var">$page</span> == <span class="php-quote">'structure'</span>) {
</span><span class="l" id="221">221         <span class="php-keyword1">require_once</span> <span class="php-var">$curDir</span> . <span class="php-quote">'/lib/handler/category_handler.php'</span>;
</span><span class="l" id="222">222     } <span class="php-keyword1">elseif</span> (<span class="php-var">$mainpage</span> == <span class="php-quote">'mediapool'</span>) {
</span><span class="l" id="223">223         <span class="php-keyword1">require_once</span> <span class="php-var">$curDir</span> . <span class="php-quote">'/lib/handler/media_handler.php'</span>;
</span><span class="l" id="224">224     } <span class="php-keyword1">elseif</span> (<span class="php-var">$page</span> == <span class="php-quote">'system/lang'</span>) {
</span><span class="l" id="225">225         <span class="php-keyword1">require_once</span> <span class="php-var">$curDir</span> . <span class="php-quote">'/lib/handler/clang_handler.php'</span>;
</span><span class="l" id="226">226     } <span class="php-keyword1">elseif</span> (<span class="php-var">$mainpage</span> == <span class="php-quote">'content'</span>) {
</span><span class="l" id="227">227         <span class="php-keyword1">require_once</span> <span class="php-var">$curDir</span> . <span class="php-quote">'/extensions/extension_content_sidebar.php'</span>;
</span><span class="l" id="228">228     } <span class="php-keyword1">elseif</span> (<span class="php-var">$page</span> == <span class="php-quote">'backup'</span>) {
</span><span class="l" id="229">229         <span class="php-keyword1">require_once</span> <span class="php-var">$curDir</span> . <span class="php-quote">'/extensions/extension_cleanup.php'</span>;
</span><span class="l" id="230">230     }
</span><span class="l" id="231">231 }
</span><span class="l" id="232">232 </span></code></pre>
 </body>
</html>
